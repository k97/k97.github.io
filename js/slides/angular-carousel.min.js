/**
 * Angular Carousel - Mobile friendly touch carousel for AngularJS
 * @version v0.0.5 - 2013-05-11
 * @link http://revolunet.com.github.com/angular-carousel
 * @author Julien Bouquillon <julien@revolunet.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("angular-carousel",[]).filter("carouselSlice",function(){return function(e,r,a){return e.slice(r,a)}}).directive("rnCarousel",["$document","$compile","$parse","$timeout",function(e,r,a){var n=0;return{restrict:"A",scope:!0,compile:function(t,s){t.addClass("rn-carousel-slides");var u=t.find("li")[0].attributes["ng-repeat"],o=u.value.match(/^([^\s]+) in (.+)$/i)[2],c=angular.isDefined(s.rnCarouselBuffered);if(c){var i="|carouselSlice:carouselBufferStart:carouselBufferStart+carouselBufferSize";u.value+=i}return function(t,s,u){function i(e,r){var a={};return a[e]=r,angular.forEach($,function(n){a["-"+n.toLowerCase()+"-"+e]=r}),a}function l(){t.$watch("carouselIndex",function(e,r){e!==r&&M()})}n++;var d="rn-carousel-"+n,f=0,v=0,x=0,m=0,I=.1,p=0,h=!0,g=s.wrap("<div id='"+d+"' class='rn-carousel-container'></div>"),B=g.parent();t.carouselItems=[],t.carouselIndex=0;var C=function(e){g.addClass("rn-carousel-noanimate").css({"padding-left":e*p+"px"})},S=function(){var e=t.carouselIndex>0&&0===t.carouselIndex-t.carouselBufferStart,r=t.carouselIndex<z()-1&&t.carouselIndex-t.carouselBufferStart===g.find("li").length-1;if(e||r){var n=e?-1:1;C(t.carouselBufferStart+n),t.$apply(function(){t.carouselBufferStart+=n}),r&&u.rnCarouselOnEnd&&a(u.rnCarouselOnEnd)(t,{index:t.carouselIndex+1})}},$=["webkit","moz"];if(c&&(t.carouselBufferSize=3,t.carouselBufferStart=0,g[0].addEventListener("webkitTransitionEnd",S,!1),g[0].addEventListener("transitionend",S,!1)),u.rnCarouselIndex){var w=a(u.rnCarouselIndex);angular.isFunction(w.assign)?(t.$watch("carouselIndex",function(e){w.assign(t.$parent,e)}),t.$parent.$watch(w,function(e,r){t.carouselIndex=e,e!==r&&M()})):isNaN(u.rnCarouselIndex)||(l(),t.carouselIndex=parseInt(u.rnCarouselIndex,10))}else l();t.$watch(o,function(e){t.carouselItems=e;var r=g.find("li");r.length>0?(p=r[0].getBoundingClientRect().width,B.css("width",p+"px"),M()):p=0},!0);var b=angular.isDefined(u.rnCarouselIndicator);if(b){var E=r("<div id='"+d+"-indicator' index='carouselIndex' items='carouselItems' data-rn-carousel-indicators class='rn-carousel-indicator'></div>")(t);B.append(E)}var z=function(){return t.carouselItems.length},M=function(){var e=h===!0;0>t.carouselIndex&&(t.carouselIndex=0),t.carouselIndex>z()-1&&(t.carouselIndex=z()-1),c&&((t.carouselIndex<t.carouselBufferStart||t.carouselIndex>t.carouselBufferStart+t.carouselBufferSize-1)&&(t.carouselBufferStart=t.carouselIndex-1,e=!0,C(t.carouselBufferStart)),t.carouselBufferStart=Math.max(0,Math.min(t.carouselBufferStart,z()-t.carouselBufferSize))),m=t.carouselIndex*-p,e===!0?g.addClass("rn-carousel-noanimate").css(i("transform","translate3d("+m+"px,0,0)")):g.removeClass("rn-carousel-noanimate").addClass("rn-carousel-animate").css(i("transform","translate3d("+m+"px,0,0)")),h=!1},X=function(e){return e.originalEvent!==void 0&&e.originalEvent.touches>0?e=e.originalEvent.touches[0]:e.touches!==void 0&&e.touches.length>0?e=e.touches[0]:e.changedTouches!==void 0&&e.changedTouches.length>0&&(e=e.changedTouches[0]),e},T=function(r){r=X(r),0===f&&(f=1,v=r.clientX),e.bind("mouseup",L)},D=function(e){if(0!==f){e.preventDefault(),e=X(e);var r=e.clientX-v;if(1===f&&0!==r)f=2,x=m;else if(2===f){var a=z(),n=1;(0===t.carouselIndex&&e.clientX>v||t.carouselIndex===a-1&&v>e.clientX)&&(n=3),m=x+r/n,g.css(i("transform","translate3d("+m+"px,0,0)")).removeClass().addClass("rn-carousel-noanimate")}}},L=function(r){e.unbind("mouseup",L),r=X(r);var a,n=z();if(f>0){f=0,a=x>m?t.carouselIndex+1:t.carouselIndex-1,a=Math.min(Math.max(a,0),n-1);var s=r.clientX-v;p*I>=Math.abs(s)&&(a=t.carouselIndex);var u=t.carouselIndex!==a;t.$apply(function(){t.carouselIndex=a}),u||M()}};B.bind("mousedown touchstart",T),B.bind("mousemove touchmove",D),B.bind("mouseup touchend",L)}}}}]).directive("rnCarouselIndicators",[function(){return{restrict:"A",replace:!0,scope:{items:"=",index:"="},template:'<div class="rn-carousel-indicator"><span ng-repeat="item in items" ng-class="{active: $index==$parent.index}">‚óè</span></div>'}}]);